<!-- templates/users/my_tasks.html -->
{% extends 'base_profile.html' %}

{% block profile_page_header %}
<!-- –ë–ª–æ–∫ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º –∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º -->
<div class="task-header-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 60px 0 40px 0; margin: -32px calc(-50vw + 50%) 40px calc(-50vw + 50%); width: 100vw; position: relative;">
    <div class="container">
        <div class="text-center text-white">
            <h1 class="display-5 fw-bold mb-3">–ú–æ–∏ –∑–∞–¥–∞—á–∏</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb justify-content-center mb-0" style="background-color: rgba(255, 255, 255, 0.2); border-radius: 0.375rem; padding: 0.75rem 1rem; display: inline-flex;">
                    <li class="breadcrumb-item">
                        <a href="{% url 'home' %}" class="text-white text-decoration-none">–ì–ª–∞–≤–Ω–∞—è</a>
                    </li>
                    <li class="breadcrumb-item">
                        <a href="{% url 'users:profile' %}" class="text-white text-decoration-none">–ü—Ä–æ—Ñ–∏–ª—å</a>
                    </li>
                    <li class="breadcrumb-item active text-white" aria-current="page">–ú–æ–∏ –∑–∞–¥–∞—á–∏</li>
                </ol>
            </nav>
        </div>
    </div>
</div>
{% endblock %}

{% block profile_content %}
<div class="card">
    <div class="card-header d-flex justify-content-end">
        <a href="{% url 'tasks:create_task' %}" class="btn btn-primary btn-sm">
            <i class="bi bi-plus-circle me-1"></i>–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
        </a>
    </div>
    <div class="card-body">
        <!-- –¢–∞–±—ã –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è -->
        <ul class="nav nav-tabs mb-4" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link {% if active_tab == 'author' %}active{% endif %}" 
                   href="{% url 'users:my_tasks' %}?tab=author" 
                   role="tab">
                    üìã –ö–∞–∫ –∑–∞–∫–∞–∑—á–∏–∫ ({{ author_tasks|length }})
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link {% if active_tab == 'executor' %}active{% endif %}" 
                   href="{% url 'users:my_tasks' %}?tab=executor" 
                   role="tab">
                    üë∑ –ö–∞–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å ({{ executor_tasks|length }})
                </a>
            </li>
        </ul>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Ç–∞–±–æ–≤ -->
        <div class="tab-content">
            <!-- –¢–∞–±: –ó–∞–¥–∞—á–∏ –∫–∞–∫ –∑–∞–∫–∞–∑—á–∏–∫ -->
            <div class="tab-pane fade {% if active_tab == 'author' %}show active{% endif %}" role="tabpanel">
                {% if author_tasks %}
                    <div class="row row-cols-1 row-cols-md-2 g-4">
                        {% for task in author_tasks %}
                            <div class="col">
                                <div class="card h-100 shadow-sm">
                                    <div class="card-body">
                                        <h6 class="card-title mb-2">{{ task.title }}</h6>
                                        <p class="text-muted small mb-2">
                                            {{ task.created_at|date:"d E Y" }} ¬∑
                                            {% if not task.is_moderated %}
                                                <span class="badge bg-warning">
                                                    <i class="bi bi-clock-history me-1"></i>–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
                                                </span>
                                            {% else %}
                                                <span class="badge 
                                                    {% if task.status == 'completed' %}bg-success
                                                    {% elif task.status == 'awaiting_confirmation' %}bg-warning
                                                    {% elif task.status == 'in_progress' %}bg-info
                                                    {% elif task.status == 'closed' %}bg-secondary
                                                    {% else %}bg-primary{% endif %}">
                                                    {{ task.get_status_display }}
                                                </span>
                                            {% endif %}
                                        </p>
                                        <p class="card-text small">{{ task.description|truncatewords:30 }}</p>
                                        <dl class="row small mb-0">
                                            <dt class="col-sm-5">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</dt>
                                            <dd class="col-sm-7">{{ task.category.name }}</dd>
                                            <dt class="col-sm-5">–ú–µ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏:</dt>
                                            <dd class="col-sm-7">{{ task.get_location_type_display }}</dd>
                                            {% if task.city %}
                                                <dt class="col-sm-5">–ì–æ—Ä–æ–¥:</dt>
                                                <dd class="col-sm-7">{{ task.city.name }}</dd>
                                            {% endif %}
                                        </dl>
                                    </div>
                                    <div class="card-footer bg-transparent border-0">
                                        <div class="d-flex gap-2">
                                            <a class="btn btn-outline-primary btn-sm flex-fill" href="{% url 'tasks:task_detail' task.get_public_slug %}">
                                                –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                            </a>
                                            {% if not task.is_moderated and task.status != 'in_progress' and task.status != 'awaiting_confirmation' and task.status != 'completed' %}
                                                <a class="btn btn-outline-secondary btn-sm" href="{% url 'tasks:edit_task' task.get_public_slug %}" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                                    <i class="bi bi-pencil"></i>
                                                </a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <p class="text-muted mb-3">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–¥–∞—á –∫–∞–∫ –∑–∞–∫–∞–∑—á–∏–∫–∞.</p>
                        <a href="{% url 'tasks:create_task' %}" class="btn btn-primary">
                            <i class="bi bi-plus-circle me-1"></i>–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É
                        </a>
                    </div>
                {% endif %}
            </div>

            <!-- –¢–∞–±: –ó–∞–¥–∞—á–∏ –∫–∞–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å -->
            <div class="tab-pane fade {% if active_tab == 'executor' %}show active{% endif %}" role="tabpanel">
                {% if executor_tasks %}
                    <div class="row row-cols-1 row-cols-md-2 g-4">
                        {% for task in executor_tasks %}
                            <div class="col">
                                <div class="card h-100 shadow-sm">
                                    <div class="card-body">
                                        <h6 class="card-title mb-2">{{ task.title }}</h6>
                                        <p class="text-muted small mb-2">
                                            {{ task.created_at|date:"d E Y" }} ¬∑
                                            <span class="badge 
                                                {% if task.status == 'completed' %}bg-success
                                                {% elif task.status == 'awaiting_confirmation' %}bg-warning
                                                {% elif task.status == 'in_progress' %}bg-info
                                                {% elif task.status == 'closed' %}bg-secondary
                                                {% else %}bg-primary{% endif %}">
                                                {{ task.get_status_display }}
                                            </span>
                                        </p>
                                        <p class="card-text small">{{ task.description|truncatewords:30 }}</p>
                                        <dl class="row small mb-0">
                                            <dt class="col-sm-5">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</dt>
                                            <dd class="col-sm-7">{{ task.category.name }}</dd>
                                            <dt class="col-sm-5">–ó–∞–∫–∞–∑—á–∏–∫:</dt>
                                            <dd class="col-sm-7">{{ task.author.get_full_name|default:task.author.username }}</dd>
                                        </dl>
                                    </div>
                                    <div class="card-footer bg-transparent border-0">
                                        <a class="btn btn-outline-primary btn-sm w-100" href="{% url 'tasks:task_detail' task.get_public_slug %}">
                                            –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                        </a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <p class="text-muted mb-3">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–¥–∞—á –∫–∞–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è.</p>
                        <a href="{% url 'tasks:task_list' %}" class="btn btn-primary">
                            <i class="bi bi-search me-1"></i>–ù–∞–π—Ç–∏ –∑–∞–¥–∞—á—É
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
